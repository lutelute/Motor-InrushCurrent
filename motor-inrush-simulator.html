<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒ¢ãƒ¼ã‚¿ãƒ¼å§‹å‹•æ™‚ çªå…¥é›»æµã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #111827; color: #e5e7eb; line-height: 1.5; }
    .container { max-width: 1200px; margin: 0 auto; padding: 16px; }
    h1 { text-align: center; color: #60a5fa; font-size: 1.5rem; margin-bottom: 8px; }
    .subtitle { text-align: center; color: #9ca3af; font-size: 0.875rem; margin-bottom: 16px; }
    
    /* ã‚¿ãƒ– */
    .tabs { display: flex; flex-wrap: wrap; gap: 4px; background: #1f2937; padding: 8px; border-radius: 8px; margin-bottom: 16px; }
    .tab { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; background: #374151; color: #d1d5db; font-size: 0.875rem; transition: all 0.2s; }
    .tab:hover { background: #4b5563; }
    .tab.active { background: #2563eb; color: white; }
    .tab-label { font-weight: 600; }
    .tab-sub { font-size: 0.75rem; opacity: 0.8; }
    
    /* ãƒ¢ãƒ¼ã‚¿ãƒ¼æƒ…å ± */
    .motor-info { display: flex; flex-wrap: wrap; gap: 16px; background: #1f2937; padding: 16px; border-radius: 8px; border-left: 4px solid #3b82f6; margin-bottom: 16px; }
    .rotor-svg { width: 128px; height: 128px; flex-shrink: 0; }
    .motor-details { flex: 1; min-width: 250px; }
    .motor-name { font-size: 1.25rem; font-weight: bold; color: #60a5fa; margin-bottom: 4px; }
    .motor-desc { font-size: 0.875rem; color: #d1d5db; margin-bottom: 12px; }
    .features-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; font-size: 0.75rem; }
    .feature-list { list-style: none; }
    .feature-list li { margin-bottom: 4px; color: #d1d5db; }
    .feature-list li::before { content: "â€¢ "; color: #60a5fa; }
    .stat { display: flex; justify-content: space-between; margin-top: 4px; }
    .stat-label { color: #9ca3af; }
    .stat-value { font-family: monospace; }
    .stat-value.yellow { color: #fbbf24; }
    .stat-value.green { color: #34d399; }
    
    /* ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ */
    .params { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; background: #1f2937; padding: 16px; border-radius: 8px; margin-bottom: 16px; }
    .param { display: flex; flex-direction: column; }
    .param label { font-size: 0.75rem; color: #9ca3af; margin-bottom: 4px; }
    .param input[type="range"] { width: 100%; accent-color: #3b82f6; }
    .param select { background: #374151; border: none; border-radius: 4px; padding: 6px; color: #e5e7eb; font-size: 0.875rem; }
    .param-value { font-size: 0.875rem; font-family: monospace; color: #93c5fd; }
    .param-hint { font-size: 0.625rem; color: #60a5fa; }
    .checkbox-group { display: flex; flex-wrap: wrap; gap: 12px; align-items: center; }
    .checkbox-group label { display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 0.75rem; }
    .checkbox-group input { width: 16px; height: 16px; accent-color: #3b82f6; }
    
    /* çµæœã‚µãƒãƒªãƒ¼ */
    .summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 8px; margin-bottom: 16px; }
    .summary-item { background: #1f2937; padding: 12px; border-radius: 8px; text-align: center; }
    .summary-label { font-size: 0.625rem; color: #9ca3af; }
    .summary-value { font-size: 1.125rem; font-weight: bold; }
    .summary-value.green { color: #34d399; }
    .summary-value.yellow { color: #fbbf24; }
    .summary-value.red { color: #f87171; }
    
    /* ã‚°ãƒ©ãƒ• */
    .chart-container { background: #1f2937; padding: 16px; border-radius: 8px; margin-bottom: 16px; }
    .chart-title { font-size: 0.875rem; color: #d1d5db; margin-bottom: 8px; }
    canvas { width: 100%; background: #111827; border-radius: 4px; }
    .chart-legend { display: flex; flex-wrap: wrap; gap: 12px; margin-top: 8px; font-size: 0.75rem; justify-content: center; }
    .legend-item { display: flex; align-items: center; gap: 4px; }
    .legend-color { width: 16px; height: 3px; border-radius: 2px; }
    .chart-note { text-align: center; font-size: 0.625rem; color: #6b7280; margin-top: 4px; }
    
    /* ç­‰ä¾¡å›è·¯ */
    .circuit-container { background: #1f2937; padding: 16px; border-radius: 8px; margin-bottom: 16px; border: 1px solid #22c55e; }
    .circuit-title { font-size: 1rem; font-weight: bold; color: #34d399; margin-bottom: 12px; }
    .circuit-buttons { margin-bottom: 12px; }
    .circuit-btn { padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; font-size: 0.75rem; margin-right: 8px; }
    .circuit-btn.active { background: #dc2626; color: white; }
    .circuit-btn.inactive { background: #374151; color: #d1d5db; }
    .circuit-btn.green.active { background: #16a34a; }
    .circuit-note { background: #374151; padding: 8px; border-radius: 4px; font-size: 0.75rem; color: #a78bfa; margin-top: 8px; }
    
    /* åŸç†ãƒãƒ¼ãƒˆ */
    .theory { background: #1f2937; padding: 20px; border-radius: 8px; margin-bottom: 16px; border: 1px solid #eab308; }
    .theory-title { font-size: 1.125rem; font-weight: bold; color: #fbbf24; margin-bottom: 16px; }
    .theory-section { margin-bottom: 20px; }
    .theory-section h4 { font-size: 0.875rem; font-weight: 600; padding-bottom: 4px; border-bottom: 1px solid #374151; margin-bottom: 8px; }
    .theory-section h4.blue { color: #60a5fa; }
    .theory-section h4.purple { color: #a78bfa; }
    .theory-section h4.green { color: #34d399; }
    .theory-section h4.cyan { color: #22d3ee; }
    .theory-section h4.red { color: #f87171; }
    .theory-section p { font-size: 0.875rem; color: #d1d5db; margin-bottom: 8px; }
    .theory-section ul, .theory-section ol { font-size: 0.75rem; color: #d1d5db; margin-left: 20px; margin-bottom: 8px; }
    .theory-section li { margin-bottom: 4px; }
    .highlight { color: #fde047; }
    .code-block { background: #374151; padding: 12px; border-radius: 4px; font-family: monospace; font-size: 0.75rem; margin: 8px 0; overflow-x: auto; }
    .formula { background: #111827; padding: 12px; border-radius: 4px; font-family: monospace; font-size: 0.875rem; text-align: center; margin: 8px 0; color: #f472b6; }
    .formula-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; }
    .formula-item { background: #111827; padding: 8px; border-radius: 4px; }
    .formula-label { color: #22d3ee; font-size: 0.75rem; margin-bottom: 4px; }
    .formula-eq { color: #d1d5db; font-family: monospace; font-size: 0.75rem; }
    .formula-note { color: #6b7280; font-size: 0.625rem; }
    .impact-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .impact-box { background: #374151; padding: 12px; border-radius: 4px; }
    .impact-box h5 { font-size: 0.75rem; font-weight: 600; margin-bottom: 8px; }
    .impact-box h5.red { color: #f87171; }
    .impact-box h5.green { color: #34d399; }
    .impact-box ul { font-size: 0.625rem; margin-left: 12px; }
    .warning-box { background: rgba(185, 28, 28, 0.2); padding: 8px; border-radius: 4px; font-size: 0.75rem; color: #fca5a5; }
    
    /* æ¯”è¼ƒè¡¨ */
    .table-container { background: #1f2937; padding: 16px; border-radius: 8px; overflow-x: auto; }
    .table-title { font-size: 0.875rem; color: #d1d5db; margin-bottom: 12px; }
    table { width: 100%; border-collapse: collapse; font-size: 0.75rem; }
    th { text-align: left; padding: 8px; color: #9ca3af; border-bottom: 1px solid #374151; }
    td { padding: 8px; border-bottom: 1px solid #374151; }
    tr:hover { background: #374151; }
    tr.selected { background: #374151; }
    .clickable { cursor: pointer; }
    .text-blue { color: #60a5fa; font-weight: 500; }
    .text-yellow { color: #fbbf24; }
    .text-green { color: #34d399; }
    
    @media (max-width: 640px) {
      .features-grid { grid-template-columns: 1fr; }
      .impact-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ãƒ¢ãƒ¼ã‚¿ãƒ¼å§‹å‹•æ™‚ çªå…¥é›»æµã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h1>
    <p class="subtitle">åœæ­¢çŠ¶æ…‹ã‹ã‚‰é›»æºæŠ•å…¥ã—ãŸç¬é–“ã®éæ¸¡é›»æµ</p>
    
    <!-- ãƒ¢ãƒ¼ã‚¿ãƒ¼ç¨®é¡ã‚¿ãƒ– -->
    <div class="tabs" id="motorTabs"></div>
    
    <!-- ãƒ¢ãƒ¼ã‚¿ãƒ¼æƒ…å ± -->
    <div class="motor-info" id="motorInfo"></div>
    
    <!-- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š -->
    <div class="params">
      <div class="param">
        <label>å®šæ ¼å‡ºåŠ› [kW]</label>
        <input type="range" id="ratedPower" min="0.75" max="37" step="0.25" value="7.5">
        <span class="param-value" id="ratedPowerVal">7.5 kW</span>
      </div>
      <div class="param">
        <label>å®šæ ¼é›»åœ§ [V]</label>
        <select id="ratedVoltage">
          <option value="200">200V</option>
          <option value="400">400V</option>
          <option value="6600">6.6kV</option>
        </select>
      </div>
      <div class="param">
        <label>é›»æºå‘¨æ³¢æ•° [Hz]</label>
        <select id="frequency">
          <option value="50">50Hz</option>
          <option value="60">60Hz</option>
        </select>
      </div>
      <div class="param">
        <label>åœæ­¢æ™‚é–“ [ms]</label>
        <input type="range" id="stopTime" min="0" max="100" step="10" value="50">
        <span class="param-value" id="stopTimeVal">50 ms</span>
      </div>
      <div class="param">
        <label>æŠ•å…¥ä½ç›¸è§’ [Â°]</label>
        <input type="range" id="switchAngle" min="0" max="360" step="15" value="0">
        <span class="param-value" id="switchAngleVal">0Â°</span>
        <span class="param-hint" id="switchAngleHint">DCæˆåˆ†æœ€å°</span>
      </div>
      <div class="param">
        <label>DCæ¸›è¡°æ™‚å®šæ•° [ms]</label>
        <input type="range" id="dcTau" min="10" max="200" step="5" value="50">
        <span class="param-value" id="dcTauVal">50 ms</span>
      </div>
      <div class="param">
        <label>è¡¨ç¤ºã‚µã‚¤ã‚¯ãƒ«æ•°</label>
        <input type="range" id="viewCycles" min="3" max="30" step="1" value="10">
        <span class="param-value" id="viewCyclesVal">10 ã‚µã‚¤ã‚¯ãƒ«</span>
      </div>
      <div class="param">
        <label>è¡¨ç¤ºã‚ªãƒ—ã‚·ãƒ§ãƒ³</label>
        <div class="checkbox-group">
          <label><input type="checkbox" id="showEnvelope" checked> åŒ…çµ¡ç·š</label>
          <label><input type="checkbox" id="showCircuit"> ğŸ”Œ ç­‰ä¾¡å›è·¯</label>
          <label><input type="checkbox" id="showTheory"> ğŸ“š åŸç†ãƒãƒ¼ãƒˆ</label>
        </div>
      </div>
    </div>
    
    <!-- è¨ˆç®—çµæœã‚µãƒãƒªãƒ¼ -->
    <div class="summary" id="summary"></div>
    
    <!-- ç­‰ä¾¡å›è·¯ -->
    <div class="circuit-container" id="circuitContainer" style="display:none;">
      <div class="circuit-title">ğŸ”Œ <span id="circuitMotorName"></span> ç­‰ä¾¡å›è·¯</div>
      <div class="circuit-buttons" id="circuitButtons"></div>
      <svg id="circuitSvg" viewBox="0 0 600 200" style="width:100%;max-width:700px;"></svg>
      <div class="circuit-note" id="circuitNote"></div>
    </div>
    
    <!-- åŸç†ãƒãƒ¼ãƒˆ -->
    <div class="theory" id="theoryContainer" style="display:none;">
      <div class="theory-title">ğŸ“š çªå…¥é›»æµã®ç™ºç”ŸåŸç†</div>
      
      <div class="theory-section">
        <h4 class="blue">1. ãªãœåœæ­¢æ™‚ã«å¤§é›»æµãŒæµã‚Œã‚‹ã®ã‹</h4>
        <p>èª˜å°ãƒ¢ãƒ¼ã‚¿ãƒ¼ã¯<span class="highlight">ã€Œå›è»¢ã™ã‚‹å¤‰åœ§å™¨ã€</span>ã¨è€ƒãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚å›ºå®šå­å·»ç·šãŒä¸€æ¬¡å´ã€å›è»¢å­å·»ç·šãŒäºŒæ¬¡å´ã«ç›¸å½“ã—ã¾ã™ã€‚</p>
        <div class="code-block">
          <span style="color:#34d399">ã€ç­‰ä¾¡å›è·¯ã®ãƒã‚¤ãƒ³ãƒˆã€‘</span><br>
          V â”€â”€â”¬â”€â”€ Râ‚ â”€â”€ jXâ‚ â”€â”€â”¬â”€â”€ jXâ‚‚' â”€â”€ Râ‚‚'/s â”€â”€â”<br>
          &nbsp;&nbsp;&nbsp;&nbsp;â”‚&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;â”‚&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;â”‚<br>
          &nbsp;&nbsp;&nbsp;&nbsp;â””â”€â”€ (åŠ±ç£å›è·¯) â”€â”€â”˜&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;â–¼ å‡ºåŠ›
        </div>
        <p><span style="color:#f87171;font-weight:600">ã‚¹ãƒªãƒƒãƒ— s</span> = (åŒæœŸé€Ÿåº¦ - å›è»¢é€Ÿåº¦) / åŒæœŸé€Ÿåº¦</p>
        <ul>
          <li><span class="highlight">åœæ­¢æ™‚: s = 1</span> â†’ Râ‚‚'/s = Râ‚‚'ï¼ˆå°ã•ã„ï¼‰â†’ <span style="color:#f87171;font-weight:bold">å¤§é›»æµï¼ˆçŸ­çµ¡çŠ¶æ…‹ã«è¿‘ã„ï¼‰</span></li>
          <li><span style="color:#34d399">å®šæ ¼é‹è»¢æ™‚: s â‰ˆ 0.02ã€œ0.05</span> â†’ Râ‚‚'/s = 20ã€œ50 Ã— Râ‚‚'ï¼ˆå¤§ãã„ï¼‰â†’ <span style="color:#34d399">å®šæ ¼é›»æµ</span></li>
        </ul>
      </div>
      
      <div class="theory-section">
        <h4 class="purple">2. DCæˆåˆ†ï¼ˆéå¯¾ç§°é›»æµï¼‰ã®ç™ºç”Ÿãƒ¡ã‚«ãƒ‹ã‚ºãƒ </h4>
        <p>ã‚¤ãƒ³ãƒ€ã‚¯ã‚¿ãƒ³ã‚¹ã‚’å«ã‚€å›è·¯ã§ã¯ã€<span class="highlight">é›»æµã¯ç¬æ™‚ã«å¤‰åŒ–ã§ããªã„</span>ã¨ã„ã†ç‰©ç†æ³•å‰‡ãŒã‚ã‚Šã¾ã™ã€‚</p>
        <div class="code-block">
          <span style="color:#60a5fa">æŠ•å…¥ç›´å‰:</span> i = 0<br>
          <span style="color:#60a5fa">æŠ•å…¥ç›´å¾Œ:</span> i = I<sub>peak</sub> Ã— sin(Ï‰t + Ï†â‚€) + <span style="color:#fbbf24">I<sub>DC</sub></span>
        </div>
        <p>é›»æµã®é€£ç¶šæ€§ã‚’ä¿ã¤ãŸã‚ã«ã€ACæˆåˆ†ã‚’æ‰“ã¡æ¶ˆã™<span class="highlight">DCæˆåˆ†</span>ãŒç™ºç”Ÿã—ã¾ã™ï¼š</p>
        <div class="formula">I<sub>DC</sub>(t) = âˆ’I<sub>peak</sub> Ã— sin(Ï†â‚€) Ã— e<sup>âˆ’t/Ï„</sup>&nbsp;&nbsp;&nbsp;(Ï„ = L/R)</div>
        <ul>
          <li><span style="color:#a78bfa">Ï†â‚€ = 0Â°, 180Â° (é›»åœ§ã‚¼ãƒ­ã‚¯ãƒ­ã‚¹)</span>: sin(Ï†â‚€) = 0 â†’ <span style="color:#34d399">DCæˆåˆ†ãªã—</span></li>
          <li><span style="color:#a78bfa">Ï†â‚€ = 90Â°, 270Â° (é›»åœ§ãƒ”ãƒ¼ã‚¯)</span>: sin(Ï†â‚€) = Â±1 â†’ <span style="color:#f87171">DCæˆåˆ†æœ€å¤§</span></li>
        </ul>
        <div class="warning-box">âš ï¸ æœ€æ‚ªã‚±ãƒ¼ã‚¹ã§ã¯ã€ACæˆåˆ† + DCæˆåˆ†ã§<span style="font-weight:bold">å®šæ ¼ã®10å€ä»¥ä¸Šã®ç¬æ™‚é›»æµ</span>ã«ãªã‚Šã¾ã™</div>
      </div>
      
      <div class="theory-section">
        <h4 class="green">3. é›»æµãŒæ¸›å°‘ã—ã¦ã„ãéç¨‹</h4>
        <div style="display:flex;align-items:center;justify-content:center;gap:8px;flex-wrap:wrap;background:#374151;padding:12px;border-radius:4px;margin:8px 0;">
          <span style="background:#dc2626;padding:4px 12px;border-radius:4px;font-size:0.75rem;">åœæ­¢ s=1</span>
          <span style="color:#9ca3af">â†’</span>
          <span style="background:#ca8a04;padding:4px 12px;border-radius:4px;font-size:0.75rem;">åŠ é€Ÿä¸­ sâ†“</span>
          <span style="color:#9ca3af">â†’</span>
          <span style="background:#16a34a;padding:4px 12px;border-radius:4px;font-size:0.75rem;">å®šæ ¼ sâ‰ˆ0.03</span>
        </div>
        <ol>
          <li>å›è»¢å­ãŒå›è»¢ã‚’å§‹ã‚ã‚‹ â†’ ã‚¹ãƒªãƒƒãƒ— s ãŒæ¸›å°‘</li>
          <li>Râ‚‚'/s ãŒå¢—åŠ  â†’ å›è»¢å­å›è·¯ã®ã‚¤ãƒ³ãƒ”ãƒ¼ãƒ€ãƒ³ã‚¹ãŒå¢—åŠ </li>
          <li>ACé›»æµæŒ¯å¹…ãŒå®šæ ¼å€¤ã«å‘ã‹ã£ã¦æ¸›å°‘</li>
          <li>åŒæ™‚ã«DCæˆåˆ†ã‚‚æ™‚å®šæ•° Ï„ = L/R ã§æŒ‡æ•°é–¢æ•°çš„ã«æ¸›è¡°</li>
        </ol>
      </div>
      
      <div class="theory-section">
        <h4 class="cyan">4. ä¸»è¦ãªæ•°å¼</h4>
        <div class="formula-grid">
          <div class="formula-item">
            <div class="formula-label">åŒæœŸé€Ÿåº¦:</div>
            <div class="formula-eq">n<sub>s</sub> = 120f / p [rpm]</div>
            <div class="formula-note">f: å‘¨æ³¢æ•°[Hz], p: æ¥µæ•°</div>
          </div>
          <div class="formula-item">
            <div class="formula-label">ã‚¹ãƒªãƒƒãƒ—:</div>
            <div class="formula-eq">s = (n<sub>s</sub> âˆ’ n) / n<sub>s</sub></div>
            <div class="formula-note">n: å›è»¢é€Ÿåº¦[rpm]</div>
          </div>
          <div class="formula-item">
            <div class="formula-label">çªå…¥é›»æµå€ç‡:</div>
            <div class="formula-eq">I<sub>start</sub> / I<sub>rated</sub> â‰ˆ 4ã€œ8å€</div>
            <div class="formula-note">æ¼ã‚Œãƒªã‚¢ã‚¯ã‚¿ãƒ³ã‚¹ã®é€†æ•°ã«æ¯”ä¾‹</div>
          </div>
          <div class="formula-item">
            <div class="formula-label">DCæˆåˆ†:</div>
            <div class="formula-eq">I<sub>DC</sub>(t) = âˆ’I<sub>m</sub> sin(Ï†â‚€) e<sup>âˆ’t/Ï„</sup></div>
            <div class="formula-note">Ï„ = L/R [s]</div>
          </div>
          <div class="formula-item" style="grid-column: span 2;">
            <div class="formula-label">æœ€å¤§ç¬æ™‚é›»æµï¼ˆæœ€æ‚ªã‚±ãƒ¼ã‚¹ Ï†â‚€=90Â°ï¼‰:</div>
            <div class="formula-eq">I<sub>max</sub> = I<sub>m</sub> Ã— (1 + |sin(Ï†â‚€)|) â‰ˆ 2 Ã— I<sub>m</sub></div>
            <div class="formula-note">ACæŒ¯å¹…ã®ç´„2å€</div>
          </div>
        </div>
      </div>
      
      <div class="theory-section">
        <h4 class="red">5. å®Ÿå‹™ä¸Šã®å½±éŸ¿ã¨å¯¾ç­–</h4>
        <div class="impact-grid">
          <div class="impact-box">
            <h5 class="red">âš ï¸ å½±éŸ¿</h5>
            <ul>
              <li>é›»æºç³»çµ±ã®é›»åœ§é™ä¸‹ï¼ˆãƒ•ãƒªãƒƒã‚«ï¼‰</li>
              <li>é®æ–­å™¨ãƒ»é›»ç£æ¥è§¦å™¨ã®æ¥ç‚¹æº¶ç€</li>
              <li>ä¿è­·ãƒªãƒ¬ãƒ¼ã®èª¤å‹•ä½œï¼ˆç¬æ™‚è¦ç´ ï¼‰</li>
              <li>å·»ç·šã®é›»ç£åŠ›ã«ã‚ˆã‚‹æ©Ÿæ¢°çš„ã‚¹ãƒˆãƒ¬ã‚¹</li>
              <li>è»¸ãƒ»ã‚«ãƒƒãƒ—ãƒªãƒ³ã‚°ã¸ã®ãƒˆãƒ«ã‚¯è¡æ’ƒ</li>
            </ul>
          </div>
          <div class="impact-box">
            <h5 class="green">âœ“ å¯¾ç­–</h5>
            <ul>
              <li><span class="highlight">ã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ«ã‚¿èµ·å‹•</span>: é›»æµã‚’1/3ã«ä½æ¸›</li>
              <li><span class="highlight">ã‚½ãƒ•ãƒˆã‚¹ã‚¿ãƒ¼ã‚¿</span>: é›»åœ§ã‚’å¾ã€…ã«ä¸Šæ˜‡</li>
              <li><span class="highlight">ã‚¤ãƒ³ãƒãƒ¼ã‚¿èµ·å‹•</span>: V/fåˆ¶å¾¡ã§æ»‘ã‚‰ã‹ã«åŠ é€Ÿ</li>
              <li><span class="highlight">ãƒªã‚¢ã‚¯ãƒˆãƒ«èµ·å‹•</span>: ç›´åˆ—Lã§é›»æµåˆ¶é™</li>
              <li><span class="highlight">å·»ç·šå‹+å¤–éƒ¨æŠµæŠ—</span>: å§‹å‹•æŠµæŠ—ã§åˆ¶å¾¡</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ä¸‰ç›¸é›»æµã‚°ãƒ©ãƒ• -->
    <div class="chart-container">
      <div class="chart-title">ä¸‰ç›¸é›»æµæ³¢å½¢ [A] - <span id="chartMotorName"></span></div>
      <canvas id="chart3phase" height="300"></canvas>
      <div class="chart-legend">
        <div class="legend-item"><div class="legend-color" style="background:#ef4444"></div>Uç›¸</div>
        <div class="legend-item"><div class="legend-color" style="background:#22c55e"></div>Vç›¸</div>
        <div class="legend-item"><div class="legend-color" style="background:#3b82f6"></div>Wç›¸</div>
        <div class="legend-item"><div class="legend-color" style="background:#6b7280;border-style:dashed"></div>åŒ…çµ¡ç·š</div>
        <div class="legend-item"><div class="legend-color" style="background:#10b981;border-style:dashed"></div>å®šæ ¼ãƒ”ãƒ¼ã‚¯</div>
      </div>
      <div class="chart-note">ç°è‰²: åœæ­¢æœŸé–“ ï½œ é»„ç·š: æŠ•å…¥ã‚¿ã‚¤ãƒŸãƒ³ã‚°</div>
    </div>
    
    <!-- DCæˆåˆ†ã‚°ãƒ©ãƒ• -->
    <div class="chart-container">
      <div class="chart-title">Uç›¸é›»æµã¨DCæˆåˆ† [A]</div>
      <canvas id="chartDC" height="200"></canvas>
      <div class="chart-legend">
        <div class="legend-item"><div class="legend-color" style="background:#ef4444"></div>Uç›¸é›»æµ</div>
        <div class="legend-item"><div class="legend-color" style="background:#f59e0b;border-style:dashed"></div>DCæˆåˆ†</div>
      </div>
    </div>
    
    <!-- æ¯”è¼ƒè¡¨ -->
    <div class="table-container">
      <div class="table-title">ãƒ¢ãƒ¼ã‚¿ãƒ¼ç¨®é¡ã®æ¯”è¼ƒ</div>
      <table id="comparisonTable">
        <thead>
          <tr>
            <th>ç¨®é¡</th>
            <th>ã‚«ãƒ†ã‚´ãƒª</th>
            <th>çªå…¥å€ç‡</th>
            <th>å§‹å‹•ãƒˆãƒ«ã‚¯</th>
            <th>ä¸»ãªç”¨é€”</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
  
  <script>
    // ãƒ¢ãƒ¼ã‚¿ãƒ¼å®šç¾©
    const MOTORS = {
      squirrelCage: {
        id: 'squirrelCage', name: 'ã‹ã”å‹èª˜å°æ©Ÿ', category: 'èª˜å°æ©Ÿ',
        description: 'æœ€ã‚‚æ™®åŠã€‚å›è»¢å­ã«å°ä½“ãƒãƒ¼ï¼ˆã‹ã”çŠ¶ï¼‰ã‚’é…ç½®ã€‚æ§‹é€ ãŒã‚·ãƒ³ãƒ—ãƒ«ã§å …ç‰¢ã€‚',
        features: ['æ§‹é€ ãŒå˜ç´”ã§å®‰ä¾¡', 'ä¿å®ˆãŒå®¹æ˜“', 'å§‹å‹•é›»æµãŒå¤§ãã„ï¼ˆå®šæ ¼ã®4ã€œ8å€ï¼‰', 'å§‹å‹•ãƒˆãƒ«ã‚¯ã¯ä¸­ç¨‹åº¦'],
        applications: 'ãƒãƒ³ãƒ—ã€ãƒ•ã‚¡ãƒ³ã€ã‚³ãƒ³ãƒ™ã‚¢ã€å·¥ä½œæ©Ÿæ¢°ãªã©',
        inrushMultiplier: 6, startTorque: 1.5, rotorType: 'cage'
      },
      woundRotor: {
        id: 'woundRotor', name: 'å·»ç·šå‹èª˜å°æ©Ÿ', category: 'èª˜å°æ©Ÿ',
        description: 'å›è»¢å­ã«ä¸‰ç›¸å·»ç·šã‚’æŒã¡ã€ã‚¹ãƒªãƒƒãƒ—ãƒªãƒ³ã‚°ã§å¤–éƒ¨æŠµæŠ—ã‚’æ¥ç¶šå¯èƒ½ã€‚',
        features: ['å¤–éƒ¨æŠµæŠ—ã§å§‹å‹•é›»æµã‚’åˆ¶å¾¡å¯èƒ½', 'å§‹å‹•ãƒˆãƒ«ã‚¯ã‚’å¤§ããã§ãã‚‹', 'é€Ÿåº¦åˆ¶å¾¡ãŒå¯èƒ½ï¼ˆåŠ¹ç‡ã¯ä½ä¸‹ï¼‰', 'æ§‹é€ ãŒè¤‡é›‘ã§ã‚³ã‚¹ãƒˆé«˜'],
        applications: 'ã‚¯ãƒ¬ãƒ¼ãƒ³ã€ãƒ›ã‚¤ã‚¹ãƒˆã€å¤§å‹ãƒãƒ³ãƒ—ã€åœ§ç¸®æ©Ÿ',
        inrushMultiplier: 3, startTorque: 2.5, rotorType: 'wound'
      },
      salientPole: {
        id: 'salientPole', name: 'çªæ¥µå‹åŒæœŸæ©Ÿ', category: 'åŒæœŸæ©Ÿ',
        description: 'ç£æ¥µãŒå›è»¢å­ã‹ã‚‰çªå‡ºã€‚ä½é€Ÿãƒ»å¤šæ¥µç”¨é€”ã«æœ€é©ã€‚',
        features: ['æ¥µæ•°ã‚’å¤šãã§ãã‚‹ï¼ˆæ°´è»Šç›´çµå‘ãï¼‰', 'å›è»¢æ•°ã¯é›»æºå‘¨æ³¢æ•°ã«åŒæœŸ', 'åŠ›ç‡èª¿æ•´ãŒå¯èƒ½', 'ãƒ€ãƒ³ãƒ‘å·»ç·šã§å§‹å‹•ï¼ˆèª˜å°æ©Ÿã¨ã—ã¦ï¼‰'],
        applications: 'æ°´åŠ›ç™ºé›»æ©Ÿã€ä½é€Ÿå¤§å‹æ©Ÿæ¢°',
        inrushMultiplier: 5, startTorque: 0.4, rotorType: 'salient'
      },
      cylindrical: {
        id: 'cylindrical', name: 'å††ç­’å‹åŒæœŸæ©Ÿ', category: 'åŒæœŸæ©Ÿ',
        description: 'å††ç­’å½¢ã®å›è»¢å­ã«æºã‚’åˆ‡ã£ã¦ç•Œç£å·»ç·šã‚’åç´ã€‚é«˜é€Ÿå›è»¢å‘ãã€‚',
        features: ['é«˜é€Ÿå›è»¢ã«é©ã—ãŸæ§‹é€ ï¼ˆ2æ¥µ/4æ¥µï¼‰', 'æ©Ÿæ¢°çš„å¼·åº¦ãŒé«˜ã„', 'é¢¨æãŒå°‘ãªã„', 'ã‚¿ãƒ¼ãƒ“ãƒ³ç›´çµã«æœ€é©'],
        applications: 'ç«åŠ›ãƒ»åŸå­åŠ›ç™ºé›»æ©Ÿï¼ˆã‚¿ãƒ¼ãƒ“ãƒ³ç™ºé›»æ©Ÿï¼‰',
        inrushMultiplier: 5, startTorque: 0.3, rotorType: 'cylindrical'
      }
    };

    let selectedMotor = 'squirrelCage';
    let circuitSlip = 1;

    // åˆæœŸåŒ–
    function init() {
      renderTabs();
      renderTable();
      bindEvents();
      update();
    }

    // ã‚¿ãƒ–æç”»
    function renderTabs() {
      const container = document.getElementById('motorTabs');
      container.innerHTML = Object.values(MOTORS).map(m => `
        <button class="tab ${m.id === selectedMotor ? 'active' : ''}" data-id="${m.id}">
          <div class="tab-label">${m.name}</div>
          <div class="tab-sub">${m.category}</div>
        </button>
      `).join('');
    }

    // æ¯”è¼ƒè¡¨æç”»
    function renderTable() {
      const tbody = document.querySelector('#comparisonTable tbody');
      tbody.innerHTML = Object.values(MOTORS).map(m => `
        <tr class="clickable ${m.id === selectedMotor ? 'selected' : ''}" data-id="${m.id}">
          <td class="text-blue">${m.name}</td>
          <td>${m.category}</td>
          <td class="text-yellow">${m.inrushMultiplier}å€</td>
          <td class="text-green">${m.startTorque} p.u.</td>
          <td>${m.applications}</td>
        </tr>
      `).join('');
    }

    // å›è»¢å­SVGç”Ÿæˆ
    function getRotorSVG(type) {
      const svgs = {
        cage: `<svg viewBox="0 0 200 200" class="rotor-svg">
          <circle cx="100" cy="100" r="80" fill="#374151" stroke="#6b7280" stroke-width="2"/>
          <circle cx="100" cy="100" r="60" fill="#1f2937" stroke="#6b7280" stroke-width="1"/>
          ${[...Array(12)].map((_, i) => {
            const a = i * 30 * Math.PI / 180;
            return `<line x1="${100+60*Math.cos(a)}" y1="${100+60*Math.sin(a)}" x2="${100+78*Math.cos(a)}" y2="${100+78*Math.sin(a)}" stroke="#f59e0b" stroke-width="4"/>`;
          }).join('')}
          <circle cx="100" cy="100" r="60" fill="none" stroke="#f59e0b" stroke-width="3"/>
          <circle cx="100" cy="100" r="78" fill="none" stroke="#f59e0b" stroke-width="3"/>
          <circle cx="100" cy="100" r="15" fill="#4b5563" stroke="#6b7280" stroke-width="2"/>
          <text x="100" y="190" text-anchor="middle" fill="#9ca3af" font-size="10">ã‹ã”å‹å›è»¢å­</text>
        </svg>`,
        wound: `<svg viewBox="0 0 200 200" class="rotor-svg">
          <circle cx="100" cy="100" r="80" fill="#374151" stroke="#6b7280" stroke-width="2"/>
          <circle cx="100" cy="100" r="60" fill="#1f2937" stroke="#6b7280" stroke-width="1"/>
          ${[[0,'#ef4444'],[120,'#22c55e'],[240,'#3b82f6']].map(([d,c]) => {
            const a = d * Math.PI / 180;
            return `<path d="M${100+30*Math.cos(a)},${100+30*Math.sin(a)} Q${100+50*Math.cos(a+0.3)},${100+50*Math.sin(a+0.3)} ${100+70*Math.cos(a)},${100+70*Math.sin(a)}" fill="none" stroke="${c}" stroke-width="3"/>
            <path d="M${100+30*Math.cos(a+Math.PI)},${100+30*Math.sin(a+Math.PI)} Q${100+50*Math.cos(a+Math.PI-0.3)},${100+50*Math.sin(a+Math.PI-0.3)} ${100+70*Math.cos(a+Math.PI)},${100+70*Math.sin(a+Math.PI)}" fill="none" stroke="${c}" stroke-width="3"/>`;
          }).join('')}
          <circle cx="100" cy="100" r="20" fill="none" stroke="#f59e0b" stroke-width="4"/>
          <circle cx="100" cy="100" r="12" fill="#4b5563" stroke="#6b7280" stroke-width="2"/>
          <text x="100" y="190" text-anchor="middle" fill="#9ca3af" font-size="10">å·»ç·šå‹å›è»¢å­</text>
        </svg>`,
        salient: `<svg viewBox="0 0 200 200" class="rotor-svg">
          <circle cx="100" cy="100" r="80" fill="#374151" stroke="#6b7280" stroke-width="2"/>
          ${[0,90,180,270].map(d => {
            const a = d * Math.PI / 180;
            const x = 100 + 45 * Math.cos(a), y = 100 + 45 * Math.sin(a);
            return `<g transform="rotate(${d},${x},${y})"><rect x="${x-15}" y="${y-25}" width="30" height="50" fill="#1f2937" stroke="#ec4899" stroke-width="2"/><rect x="${x-10}" y="${y-20}" width="20" height="40" fill="none" stroke="#f59e0b" stroke-width="2"/></g>`;
          }).join('')}
          <circle cx="100" cy="100" r="25" fill="#4b5563" stroke="#6b7280" stroke-width="2"/>
          <text x="100" y="190" text-anchor="middle" fill="#9ca3af" font-size="10">çªæ¥µå‹å›è»¢å­</text>
        </svg>`,
        cylindrical: `<svg viewBox="0 0 200 200" class="rotor-svg">
          <circle cx="100" cy="100" r="80" fill="#374151" stroke="#6b7280" stroke-width="2"/>
          <circle cx="100" cy="100" r="65" fill="#1f2937" stroke="#6b7280" stroke-width="1"/>
          ${[...Array(24)].map((_, i) => {
            const a = i * 15 * Math.PI / 180;
            return `<line x1="${100+40*Math.cos(a)}" y1="${100+40*Math.sin(a)}" x2="${100+63*Math.cos(a)}" y2="${100+63*Math.sin(a)}" stroke="#f59e0b" stroke-width="2"/>`;
          }).join('')}
          <circle cx="100" cy="100" r="40" fill="#1f2937" stroke="#6b7280" stroke-width="1"/>
          <circle cx="100" cy="100" r="15" fill="#4b5563" stroke="#6b7280" stroke-width="2"/>
          <text x="100" y="190" text-anchor="middle" fill="#9ca3af" font-size="10">å††ç­’å‹å›è»¢å­</text>
        </svg>`
      };
      return svgs[type] || svgs.cage;
    }

    // ç­‰ä¾¡å›è·¯SVG
    function drawCircuit() {
      const motor = MOTORS[selectedMotor];
      const svg = document.getElementById('circuitSvg');
      const isInduction = motor.category === 'èª˜å°æ©Ÿ';
      const hasExt = motor.id === 'woundRotor';
      const isSalient = motor.id === 'salientPole';
      
      document.getElementById('circuitMotorName').textContent = motor.name;
      
      if (isInduction) {
        document.getElementById('circuitButtons').innerHTML = `
          <button class="circuit-btn ${circuitSlip === 1 ? 'active' : 'inactive'}" onclick="setSlip(1)">s = 1 (åœæ­¢)</button>
          <button class="circuit-btn ${circuitSlip === 0.03 ? 'active green' : 'inactive'}" onclick="setSlip(0.03)">s = 0.03 (å®šæ ¼)</button>
        `;
        svg.innerHTML = `
          <rect x="0" y="0" width="600" height="200" fill="#1f2937" rx="8"/>
          <circle cx="30" cy="100" r="16" fill="none" stroke="#3b82f6" stroke-width="2"/>
          <text x="30" y="105" text-anchor="middle" fill="#3b82f6" font-size="12" font-weight="bold">V</text>
          <line x1="30" y1="84" x2="30" y2="40" stroke="#9ca3af" stroke-width="2"/>
          <line x1="30" y1="116" x2="30" y2="160" stroke="#9ca3af" stroke-width="2"/>
          <line x1="30" y1="40" x2="70" y2="40" stroke="#9ca3af" stroke-width="2"/>
          <rect x="70" y="30" width="40" height="20" fill="none" stroke="#ef4444" stroke-width="2"/>
          <text x="90" y="25" text-anchor="middle" fill="#ef4444" font-size="10">Râ‚</text>
          <line x1="110" y1="40" x2="140" y2="40" stroke="#9ca3af" stroke-width="2"/>
          <path d="M140,40 Q150,30 160,40 Q170,50 180,40 Q190,30 200,40" fill="none" stroke="#f59e0b" stroke-width="2"/>
          <text x="170" y="25" text-anchor="middle" fill="#f59e0b" font-size="10">jXâ‚</text>
          <line x1="200" y1="40" x2="240" y2="40" stroke="#9ca3af" stroke-width="2"/>
          <circle cx="240" cy="40" r="3" fill="#9ca3af"/>
          <line x1="240" y1="40" x2="240" y2="70" stroke="#9ca3af" stroke-width="2"/>
          <path d="M240,70 Q230,80 240,90 Q250,100 240,110 Q230,120 240,130" fill="none" stroke="#22c55e" stroke-width="2"/>
          <text x="220" y="105" text-anchor="end" fill="#22c55e" font-size="9">jXâ‚˜</text>
          <line x1="240" y1="130" x2="240" y2="160" stroke="#9ca3af" stroke-width="2"/>
          <line x1="240" y1="40" x2="290" y2="40" stroke="#9ca3af" stroke-width="2"/>
          <path d="M290,40 Q300,30 310,40 Q320,50 330,40 Q340,30 350,40" fill="none" stroke="#f59e0b" stroke-width="2"/>
          <text x="320" y="25" text-anchor="middle" fill="#f59e0b" font-size="10">jXâ‚‚'</text>
          <line x1="350" y1="40" x2="390" y2="40" stroke="#9ca3af" stroke-width="2"/>
          <rect x="390" y="30" width="50" height="20" fill="none" stroke="#ec4899" stroke-width="2"/>
          <text x="415" y="25" text-anchor="middle" fill="#ec4899" font-size="10">Râ‚‚'/s</text>
          <line x1="440" y1="40" x2="470" y2="40" stroke="#9ca3af" stroke-width="2"/>
          ${hasExt ? `
            <rect x="470" y="30" width="40" height="20" fill="none" stroke="#a855f7" stroke-width="2" stroke-dasharray="4,2"/>
            <text x="490" y="25" text-anchor="middle" fill="#a855f7" font-size="10">R_ext</text>
            <line x1="510" y1="40" x2="560" y2="40" stroke="#9ca3af" stroke-width="2"/>
          ` : `<line x1="470" y1="40" x2="560" y2="40" stroke="#9ca3af" stroke-width="2"/>`}
          <line x1="560" y1="40" x2="560" y2="160" stroke="#9ca3af" stroke-width="2"/>
          <line x1="30" y1="160" x2="560" y2="160" stroke="#9ca3af" stroke-width="2"/>
          <rect x="390" y="60" width="70" height="25" fill="#374151" rx="4"/>
          <text x="425" y="75" text-anchor="middle" fill="#9ca3af" font-size="9">s = ${circuitSlip}</text>
          <text x="425" y="83" text-anchor="middle" fill="#ec4899" font-size="7">${circuitSlip === 1 ? '(åœæ­¢)' : '(å®šæ ¼)'}</text>
          <text x="20" y="190" fill="#9ca3af" font-size="8">Râ‚:ä¸€æ¬¡æŠµæŠ— Xâ‚,Xâ‚‚':æ¼ã‚Œãƒªã‚¢ã‚¯ã‚¿ãƒ³ã‚¹ Xâ‚˜:åŠ±ç£ Râ‚‚'/s:äºŒæ¬¡æŠµæŠ—${hasExt ? ' R_ext:å¤–éƒ¨æŠµæŠ—' : ''}</text>
        `;
        document.getElementById('circuitNote').innerHTML = hasExt 
          ? 'ğŸ’¡ å·»ç·šå‹ã¯ã‚¹ãƒªãƒƒãƒ—ãƒªãƒ³ã‚°çµŒç”±ã§å¤–éƒ¨æŠµæŠ— R_ext ã‚’æ¥ç¶šå¯èƒ½ã€‚å§‹å‹•æ™‚ã«æŠµæŠ—ã‚’å¤§ããã—ã¦é›»æµã‚’æŠ‘åˆ¶ã§ãã¾ã™ã€‚'
          : '';
      } else {
        document.getElementById('circuitButtons').innerHTML = '';
        svg.innerHTML = `
          <rect x="0" y="0" width="600" height="200" fill="#1f2937" rx="8"/>
          <circle cx="30" cy="100" r="16" fill="none" stroke="#3b82f6" stroke-width="2"/>
          <text x="30" y="105" text-anchor="middle" fill="#3b82f6" font-size="12" font-weight="bold">V</text>
          <line x1="30" y1="84" x2="30" y2="40" stroke="#9ca3af" stroke-width="2"/>
          <line x1="30" y1="116" x2="30" y2="160" stroke="#9ca3af" stroke-width="2"/>
          <line x1="30" y1="40" x2="70" y2="40" stroke="#9ca3af" stroke-width="2"/>
          <rect x="70" y="30" width="40" height="20" fill="none" stroke="#ef4444" stroke-width="2"/>
          <text x="90" y="25" text-anchor="middle" fill="#ef4444" font-size="10">Râ‚</text>
          <line x1="110" y1="40" x2="150" y2="40" stroke="#9ca3af" stroke-width="2"/>
          <path d="M150,40 Q165,25 180,40 Q195,55 210,40 Q225,25 240,40 Q255,55 270,40" fill="none" stroke="#f59e0b" stroke-width="2"/>
          <text x="210" y="22" text-anchor="middle" fill="#f59e0b" font-size="10">${isSalient ? 'jXd' : 'jXs'}</text>
          ${isSalient ? '<text x="210" y="62" text-anchor="middle" fill="#f59e0b" font-size="8" opacity="0.7">jXq</text>' : ''}
          <line x1="270" y1="40" x2="330" y2="40" stroke="#9ca3af" stroke-width="2"/>
          <circle cx="360" cy="40" r="22" fill="none" stroke="#22c55e" stroke-width="2"/>
          <text x="360" y="45" text-anchor="middle" fill="#22c55e" font-size="14" font-weight="bold">E</text>
          <text x="360" y="75" text-anchor="middle" fill="#22c55e" font-size="8">èª˜èµ·é›»åœ§</text>
          <line x1="382" y1="40" x2="420" y2="40" stroke="#9ca3af" stroke-width="2"/>
          <rect x="420" y="20" width="100" height="50" fill="#374151" stroke="#a855f7" stroke-width="2" rx="4"/>
          <text x="470" y="42" text-anchor="middle" fill="#a855f7" font-size="10">ç•Œç£å›è·¯</text>
          <text x="470" y="55" text-anchor="middle" fill="#a855f7" font-size="8">(DCåŠ±ç£)</text>
          <line x1="520" y1="45" x2="560" y2="45" stroke="#9ca3af" stroke-width="2"/>
          <line x1="560" y1="45" x2="560" y2="160" stroke="#9ca3af" stroke-width="2"/>
          <line x1="30" y1="160" x2="560" y2="160" stroke="#9ca3af" stroke-width="2"/>
          <text x="20" y="190" fill="#9ca3af" font-size="8">Râ‚:é›»æ©Ÿå­æŠµæŠ— ${isSalient ? 'Xd,Xq:ç›´è»¸ãƒ»æ¨ªè»¸ãƒªã‚¢ã‚¯ã‚¿ãƒ³ã‚¹' : 'Xs:åŒæœŸãƒªã‚¢ã‚¯ã‚¿ãƒ³ã‚¹'} E:èª˜èµ·é›»åœ§</text>
        `;
        document.getElementById('circuitNote').innerHTML = 'ğŸ’¡ åŒæœŸæ©Ÿã¯è‡ªå·±å§‹å‹•ã§ããªã„ãŸã‚ã€ãƒ€ãƒ³ãƒ‘å·»ç·šã§èª˜å°æ©Ÿã¨ã—ã¦å§‹å‹•â†’åŒæœŸå¼•å…¥ã‚Œã€ã¾ãŸã¯ã‚¤ãƒ³ãƒãƒ¼ã‚¿å§‹å‹•ãŒå¿…è¦ã§ã™ã€‚';
      }
    }

    function setSlip(s) {
      circuitSlip = s;
      drawCircuit();
    }

    // ãƒ¢ãƒ¼ã‚¿ãƒ¼æƒ…å ±æ›´æ–°
    function updateMotorInfo() {
      const motor = MOTORS[selectedMotor];
      document.getElementById('motorInfo').innerHTML = `
        ${getRotorSVG(motor.rotorType)}
        <div class="motor-details">
          <div class="motor-name">${motor.name}</div>
          <div class="motor-desc">${motor.description}</div>
          <div class="features-grid">
            <div>
              <div style="color:#9ca3af;font-size:0.625rem;margin-bottom:4px;">ç‰¹å¾´</div>
              <ul class="feature-list">
                ${motor.features.map(f => `<li>${f}</li>`).join('')}
              </ul>
            </div>
            <div>
              <div style="color:#9ca3af;font-size:0.625rem;margin-bottom:4px;">ç”¨é€”</div>
              <p style="font-size:0.75rem;color:#d1d5db;margin-bottom:8px;">${motor.applications}</p>
              <div class="stat"><span class="stat-label">çªå…¥é›»æµå€ç‡:</span><span class="stat-value yellow">${motor.inrushMultiplier}å€</span></div>
              <div class="stat"><span class="stat-label">å§‹å‹•ãƒˆãƒ«ã‚¯:</span><span class="stat-value green">${motor.startTorque} p.u.</span></div>
            </div>
          </div>
        </div>
      `;
      document.getElementById('chartMotorName').textContent = motor.name;
    }

    // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨ˆç®—
    function simulate() {
      const motor = MOTORS[selectedMotor];
      const P = parseFloat(document.getElementById('ratedPower').value);
      const V = parseFloat(document.getElementById('ratedVoltage').value);
      const f = parseFloat(document.getElementById('frequency').value);
      const stopMs = parseFloat(document.getElementById('stopTime').value);
      const phi0Deg = parseFloat(document.getElementById('switchAngle').value);
      const tauDC = parseFloat(document.getElementById('dcTau').value) / 1000;
      const cycles = parseFloat(document.getElementById('viewCycles').value);
      const mult = motor.inrushMultiplier;

      const omega = 2 * Math.PI * f;
      const period = 1 / f;
      const Irated = (P * 1000) / (Math.sqrt(3) * V * 0.85);
      const Ipeak = Irated * Math.sqrt(2);
      const IpeakInrush = Ipeak * mult;
      const phi0 = phi0Deg * Math.PI / 180;
      const tauAC = motor.category === 'åŒæœŸæ©Ÿ' ? 0.5 : 0.3;

      const stopS = stopMs / 1000;
      const runTime = period * cycles;
      const totalTime = stopS + runTime;
      const dt = period / 100;
      const steps = Math.floor(totalTime / dt);

      const data = [];
      let maxI = 0;

      for (let i = 0; i <= steps; i++) {
        const t = i * dt;
        const tMs = t * 1000;

        if (t < stopS) {
          data.push({ t: tMs, iU: 0, iV: 0, iW: 0, envP: 0, envN: 0, dcU: 0 });
          continue;
        }

        const tRun = t - stopS;
        const decay = 1 + (mult - 1) * Math.exp(-tRun / tauAC);
        const amp = Ipeak * decay;

        const dcU = -amp * Math.sin(phi0) * Math.exp(-tRun / tauDC);
        const dcV = -amp * Math.sin(phi0 - 2*Math.PI/3) * Math.exp(-tRun / tauDC);
        const dcW = -amp * Math.sin(phi0 + 2*Math.PI/3) * Math.exp(-tRun / tauDC);

        const iU = amp * Math.sin(omega * tRun + phi0) + dcU;
        const iV = amp * Math.sin(omega * tRun + phi0 - 2*Math.PI/3) + dcV;
        const iW = amp * Math.sin(omega * tRun + phi0 + 2*Math.PI/3) + dcW;

        maxI = Math.max(maxI, Math.abs(iU), Math.abs(iV), Math.abs(iW));

        data.push({
          t: tMs,
          iU, iV, iW,
          envP: amp + Math.abs(dcU),
          envN: -(amp + Math.abs(dcU)),
          dcU
        });
      }

      return { data, Irated, Ipeak, IpeakInrush, maxI, stopMs };
    }

    // ã‚°ãƒ©ãƒ•æç”»
    function drawCharts(sim) {
      const showEnv = document.getElementById('showEnvelope').checked;
      
      // ä¸‰ç›¸é›»æµã‚°ãƒ©ãƒ•
      const canvas1 = document.getElementById('chart3phase');
      const ctx1 = canvas1.getContext('2d');
      const W = canvas1.width = canvas1.offsetWidth * 2;
      const H = canvas1.height = 300 * 2;
      ctx1.scale(2, 2);
      const w = W / 2, h = H / 2;
      
      ctx1.fillStyle = '#111827';
      ctx1.fillRect(0, 0, w, h);

      const data = sim.data;
      const tMax = data[data.length - 1].t;
      const iMax = Math.max(sim.maxI, sim.Ipeak) * 1.2;
      
      const margin = { l: 50, r: 20, t: 20, b: 40 };
      const pw = w - margin.l - margin.r;
      const ph = h - margin.t - margin.b;

      const toX = t => margin.l + (t / tMax) * pw;
      const toY = i => margin.t + ph / 2 - (i / iMax) * (ph / 2);

      // åœæ­¢æœŸé–“
      ctx1.fillStyle = 'rgba(31,41,55,0.8)';
      ctx1.fillRect(margin.l, margin.t, (sim.stopMs / tMax) * pw, ph);

      // ã‚°ãƒªãƒƒãƒ‰
      ctx1.strokeStyle = '#374151';
      ctx1.lineWidth = 0.5;
      for (let i = 0; i <= 5; i++) {
        const y = margin.t + (i / 5) * ph;
        ctx1.beginPath(); ctx1.moveTo(margin.l, y); ctx1.lineTo(w - margin.r, y); ctx1.stroke();
      }
      for (let i = 0; i <= 10; i++) {
        const x = margin.l + (i / 10) * pw;
        ctx1.beginPath(); ctx1.moveTo(x, margin.t); ctx1.lineTo(x, margin.t + ph); ctx1.stroke();
      }

      // ã‚¼ãƒ­ãƒ©ã‚¤ãƒ³
      ctx1.strokeStyle = '#4b5563';
      ctx1.lineWidth = 1;
      ctx1.beginPath(); ctx1.moveTo(margin.l, toY(0)); ctx1.lineTo(w - margin.r, toY(0)); ctx1.stroke();

      // å®šæ ¼ãƒ”ãƒ¼ã‚¯ãƒ©ã‚¤ãƒ³
      ctx1.strokeStyle = '#10b981';
      ctx1.setLineDash([5, 5]);
      ctx1.beginPath(); ctx1.moveTo(margin.l, toY(sim.Ipeak)); ctx1.lineTo(w - margin.r, toY(sim.Ipeak)); ctx1.stroke();
      ctx1.beginPath(); ctx1.moveTo(margin.l, toY(-sim.Ipeak)); ctx1.lineTo(w - margin.r, toY(-sim.Ipeak)); ctx1.stroke();
      ctx1.setLineDash([]);

      // æŠ•å…¥ãƒ©ã‚¤ãƒ³
      ctx1.strokeStyle = '#f59e0b';
      ctx1.lineWidth = 2;
      const xSwitch = toX(sim.stopMs);
      ctx1.beginPath(); ctx1.moveTo(xSwitch, margin.t); ctx1.lineTo(xSwitch, margin.t + ph); ctx1.stroke();
      ctx1.fillStyle = '#f59e0b';
      ctx1.font = '10px sans-serif';
      ctx1.fillText('æŠ•å…¥', xSwitch + 3, margin.t + 12);

      // åŒ…çµ¡ç·š
      if (showEnv) {
        ctx1.strokeStyle = '#6b7280';
        ctx1.lineWidth = 1;
        ctx1.setLineDash([3, 3]);
        ctx1.beginPath();
        data.forEach((d, i) => i === 0 ? ctx1.moveTo(toX(d.t), toY(d.envP)) : ctx1.lineTo(toX(d.t), toY(d.envP)));
        ctx1.stroke();
        ctx1.beginPath();
        data.forEach((d, i) => i === 0 ? ctx1.moveTo(toX(d.t), toY(d.envN)) : ctx1.lineTo(toX(d.t), toY(d.envN)));
        ctx1.stroke();
        ctx1.setLineDash([]);
      }

      // æ³¢å½¢æç”»
      const drawLine = (key, color) => {
        ctx1.strokeStyle = color;
        ctx1.lineWidth = 1.5;
        ctx1.beginPath();
        data.forEach((d, i) => i === 0 ? ctx1.moveTo(toX(d.t), toY(d[key])) : ctx1.lineTo(toX(d.t), toY(d[key])));
        ctx1.stroke();
      };
      drawLine('iU', '#ef4444');
      drawLine('iV', '#22c55e');
      drawLine('iW', '#3b82f6');

      // è»¸ãƒ©ãƒ™ãƒ«
      ctx1.fillStyle = '#9ca3af';
      ctx1.font = '10px sans-serif';
      ctx1.textAlign = 'center';
      ctx1.fillText('æ™‚é–“ [ms]', w / 2, h - 5);
      ctx1.textAlign = 'right';
      for (let i = 0; i <= 5; i++) {
        const val = iMax * (1 - i / 2.5);
        ctx1.fillText(val.toFixed(0), margin.l - 5, margin.t + (i / 5) * ph + 4);
      }
      ctx1.textAlign = 'center';
      for (let i = 0; i <= 5; i++) {
        const val = (i / 5) * tMax;
        ctx1.fillText(val.toFixed(0), margin.l + (i / 5) * pw, h - margin.b + 15);
      }

      // DCæˆåˆ†ã‚°ãƒ©ãƒ•
      const canvas2 = document.getElementById('chartDC');
      const ctx2 = canvas2.getContext('2d');
      const W2 = canvas2.width = canvas2.offsetWidth * 2;
      const H2 = canvas2.height = 200 * 2;
      ctx2.scale(2, 2);
      const w2 = W2 / 2, h2 = H2 / 2;

      ctx2.fillStyle = '#111827';
      ctx2.fillRect(0, 0, w2, h2);

      const margin2 = { l: 50, r: 20, t: 15, b: 30 };
      const pw2 = w2 - margin2.l - margin2.r;
      const ph2 = h2 - margin2.t - margin2.b;

      const toX2 = t => margin2.l + (t / tMax) * pw2;
      const toY2 = i => margin2.t + ph2 / 2 - (i / iMax) * (ph2 / 2);

      // åœæ­¢æœŸé–“
      ctx2.fillStyle = 'rgba(31,41,55,0.8)';
      ctx2.fillRect(margin2.l, margin2.t, (sim.stopMs / tMax) * pw2, ph2);

      // ã‚°ãƒªãƒƒãƒ‰
      ctx2.strokeStyle = '#374151';
      ctx2.lineWidth = 0.5;
      for (let i = 0; i <= 4; i++) {
        const y = margin2.t + (i / 4) * ph2;
        ctx2.beginPath(); ctx2.moveTo(margin2.l, y); ctx2.lineTo(w2 - margin2.r, y); ctx2.stroke();
      }

      // ã‚¼ãƒ­ãƒ©ã‚¤ãƒ³
      ctx2.strokeStyle = '#4b5563';
      ctx2.lineWidth = 1;
      ctx2.beginPath(); ctx2.moveTo(margin2.l, toY2(0)); ctx2.lineTo(w2 - margin2.r, toY2(0)); ctx2.stroke();

      // æŠ•å…¥ãƒ©ã‚¤ãƒ³
      ctx2.strokeStyle = '#f59e0b';
      ctx2.lineWidth = 2;
      ctx2.beginPath(); ctx2.moveTo(toX2(sim.stopMs), margin2.t); ctx2.lineTo(toX2(sim.stopMs), margin2.t + ph2); ctx2.stroke();

      // Uç›¸
      ctx2.strokeStyle = '#ef4444';
      ctx2.lineWidth = 2;
      ctx2.beginPath();
      data.forEach((d, i) => i === 0 ? ctx2.moveTo(toX2(d.t), toY2(d.iU)) : ctx2.lineTo(toX2(d.t), toY2(d.iU)));
      ctx2.stroke();

      // DCæˆåˆ†
      ctx2.strokeStyle = '#f59e0b';
      ctx2.lineWidth = 2;
      ctx2.setLineDash([5, 5]);
      ctx2.beginPath();
      data.forEach((d, i) => i === 0 ? ctx2.moveTo(toX2(d.t), toY2(d.dcU)) : ctx2.lineTo(toX2(d.t), toY2(d.dcU)));
      ctx2.stroke();
      ctx2.setLineDash([]);
    }

    // ã‚µãƒãƒªãƒ¼æ›´æ–°
    function updateSummary(sim) {
      document.getElementById('summary').innerHTML = `
        <div class="summary-item"><div class="summary-label">å®šæ ¼é›»æµ</div><div class="summary-value green">${sim.Irated.toFixed(1)} A</div></div>
        <div class="summary-item"><div class="summary-label">å®šæ ¼ãƒ”ãƒ¼ã‚¯</div><div class="summary-value green">${sim.Ipeak.toFixed(1)} A</div></div>
        <div class="summary-item"><div class="summary-label">çªå…¥ãƒ”ãƒ¼ã‚¯</div><div class="summary-value yellow">${sim.IpeakInrush.toFixed(1)} A</div></div>
        <div class="summary-item"><div class="summary-label">æœ€å¤§ç¬æ™‚é›»æµ</div><div class="summary-value red">${sim.maxI.toFixed(1)} A</div></div>
        <div class="summary-item"><div class="summary-label">å¯¾å®šæ ¼æ¯”</div><div class="summary-value red">${(sim.maxI / sim.Ipeak).toFixed(1)} å€</div></div>
      `;
    }

    // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¡¨ç¤ºæ›´æ–°
    function updateParamDisplay() {
      document.getElementById('ratedPowerVal').textContent = document.getElementById('ratedPower').value + ' kW';
      document.getElementById('stopTimeVal').textContent = document.getElementById('stopTime').value + ' ms';
      const angle = document.getElementById('switchAngle').value;
      document.getElementById('switchAngleVal').textContent = angle + 'Â°';
      const hint = (angle == 0 || angle == 180) ? 'DCæˆåˆ†æœ€å°' : (angle == 90 || angle == 270) ? 'DCæˆåˆ†æœ€å¤§' : '';
      document.getElementById('switchAngleHint').textContent = hint;
      document.getElementById('dcTauVal').textContent = document.getElementById('dcTau').value + ' ms';
      document.getElementById('viewCyclesVal').textContent = document.getElementById('viewCycles').value + ' ã‚µã‚¤ã‚¯ãƒ«';
    }

    // å…¨ä½“æ›´æ–°
    function update() {
      updateMotorInfo();
      updateParamDisplay();
      const sim = simulate();
      updateSummary(sim);
      drawCharts(sim);
      
      const showCirc = document.getElementById('showCircuit').checked;
      document.getElementById('circuitContainer').style.display = showCirc ? 'block' : 'none';
      if (showCirc) drawCircuit();
      
      document.getElementById('theoryContainer').style.display = document.getElementById('showTheory').checked ? 'block' : 'none';
    }

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒ‰
    function bindEvents() {
      document.getElementById('motorTabs').addEventListener('click', e => {
        const btn = e.target.closest('.tab');
        if (btn) {
          selectedMotor = btn.dataset.id;
          renderTabs();
          renderTable();
          update();
        }
      });

      document.querySelector('#comparisonTable tbody').addEventListener('click', e => {
        const row = e.target.closest('tr');
        if (row) {
          selectedMotor = row.dataset.id;
          renderTabs();
          renderTable();
          update();
        }
      });

      ['ratedPower', 'ratedVoltage', 'frequency', 'stopTime', 'switchAngle', 'dcTau', 'viewCycles', 'showEnvelope', 'showCircuit', 'showTheory'].forEach(id => {
        document.getElementById(id).addEventListener('input', update);
        document.getElementById(id).addEventListener('change', update);
      });

      window.addEventListener('resize', () => {
        const sim = simulate();
        drawCharts(sim);
      });
    }

    init();
  </script>
</body>
</html>
